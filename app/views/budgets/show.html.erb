<div class="pb-12">
  <div class="flex items-center gap-2 mb-4">
    <div class="flex items-center gap-2">
      <% if @budget.previous_budget %>
        <%= link_to budget_path(@budget.previous_budget) do %>
          <%= lucide_icon "chevron-left" %>
        <% end %>
      <% else %>
        <%= lucide_icon "chevron-left", class: "text-gray-400" %>
      <% end %>

      <% if @budget.next_budget %>
        <%= link_to budget_path(@budget.next_budget) do %>
          <%= lucide_icon "chevron-right" %>
        <% end %>
      <% else %>
        <%= lucide_icon "chevron-right", class: "text-gray-400" %>
      <% end %>
    </div>

    <div data-controller="menu" data-menu-placement-value="bottom-start">
      <%= tag.button @budget.name, data: { menu_target: "button" } %>

      <div data-menu-target="content" class="hidden">
        <%= render "budgets/picker", family: Current.family, year: Date.current.year %>
      </div>
    </div>

    <div class="ml-auto">
      <% if @budget.current? %>
        <span class="border border-alpha-black-200 text-gray-900 text-sm font-medium px-3 py-2 rounded-lg">Today</span>
      <% else %>
        <%= link_to "Go to latest budget", budget_path(Current.family.budgets.current), class: "btn btn--outline" %>
      <% end %>
    </div>
  </div>

  <div class="flex gap-4">
    <div class="w-[300px] space-y-4">
      <div class="bg-white rounded-xl shadow-xs p-8 border border-gray-100 h-[300px]">
        <%= render "budgets/pie_chart_summary", budget: @budget %>
      </div>
      <div>
        <% if @budget.initialized? %>
          <% default_tab = @budget.initialized? ? "budgeted" : "actuals" %>
          <% default_partial = { "actuals" => "budgets/actuals_summary", "budgeted" => "budgets/budgeted_summary" } %>

          <div class="flex gap-2 mb-2 rounded-lg bg-alpha-black-25 p-1">
            <% base_classes = "rounded-md px-2 py-1 flex-1 text-center" %>
            <% tab_classes = ->(tab) do
            selected = params[:tab] == tab || (default_tab == tab && params[:tab].nil?)
            class_names(base_classes,
              "bg-white shadow-xs text-gray-900" => selected,
              "text-gray-500" => !selected)
          end %>

            <%= link_to "Actual", budget_path(@budget, tab: "actuals"), class: tab_classes.call("actuals") %>
            <%= link_to "Budgeted", budget_path(@budget, tab: "budgeted"), class: tab_classes.call("budgeted") %>
          </div>

          <div class="bg-white rounded-xl shadow-xs border border-gray-100">
            <% if params[:tab] == "actuals" %>
              <%= render "budgets/actuals_summary" %>
            <% elsif params[:tab] == "budgeted" %>
              <%= render "budgets/budgeted_summary" %>
            <% else %>
              <%= render default_partial[default_tab] %>
            <% end %>
          </div>
        <% else %>
          <div class="bg-white rounded-xl shadow-xs border border-gray-100">
            <%= render "budgets/actuals_summary" %>
          </div>
        <% end %>
      </div>
    </div>
    <div class="grow h-[2000px] bg-white rounded-xl shadow-xs p-4 border border-gray-100">
      Budget
    </div>
  </div>
</div>
