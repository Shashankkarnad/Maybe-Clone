<%= form_with model: @import, url: load_import_path(@import), class: "dropzone dropzone-default dz-clickable", data: { controller: "dropzone", dropzone_max_file_size: "5", dropzone_accepted_files: ",csv, text/csv, application/vnd.ms-excel, application/csv, text/x-csv, application/x-csv, text/comma-separated-values, text/x-comma-separated-values", dropzone_max_files: "1" }, method: :patch, multipart: true do |form| %>
  <div class="flex items-center justify-center w-full">
    <label for="raw_csv_str" class="flex flex-col items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-gray-50">
      <div class="flex flex-col items-center justify-center pt-5 pb-6">
        <%= lucide_icon "plus", class: "w-5 h-5 text-gray-500" %>
        <%= form.file_field :raw_csv_str, direct_upload: false, data: { dropzone_target: 'input' } %>
        <p class="mb-2 text-sm text-gray-500 mt-3 dropzone-msg dz-message">Drag and drop your csv file here or <span class="text-black needsclick">click to browse</span></p>
        <p class="text-xs text-gray-500">CSV (Max. 5MB)</p>
        <div class="csv-preview"></div>
      </div>
    </label>
  </div>
  <%= form.submit t(".next"), class: "px-4 py-2 mb-4 block w-full rounded-lg bg-alpha-black-25 text-gray text-sm font-medium cursor-not-allowed", data: { turbo_confirm: (@import.raw_csv_str? ? { title: t(".confirm_title"), body: t(".confirm_body"), accept: t(".confirm_accept") } : nil) }, disabled: true %>
<% end %>

<div id="template-preview" class="hidden">
  <div class="dz-preview dz-file-preview flex flex-col items-center justify-center" id="dz-preview-template">
    <%= lucide_icon "file-text", class: "w-10 h-10 pt-2 text-black" %>
    <div class="dz-details flex flex-row items-center justify-center gap-0.5">
      <div class="dz-filename"><span data-dz-name></span></div>
      <div class="dz-size" data-dz-size></div>
    </div>
    <div class="dz-progress"><span class="dz-upload" data-dz-uploadprogress></span></div>
    <div class="dz-success-mark"><span></span></div>
    <div class="dz-error-mark"><span></span></div>
    <div class="dz-error-message"><span data-dz-errormessage></span></div>
  </div>
</div>

<div class="bg-alpha-black-25 rounded-xl p-1 mt-5">
  <div class="text-gray-500 p-2 mb-2">
    <div class="flex gap-2 mb-2">
      <%= lucide_icon("info", class: "w-5 h-5 shrink-0") %>
      <p class="text-sm">
        <%= t(".instructions") %>
        <span class="text-black underline">
          <%= link_to 'download this template', '/transactions.csv', download: '' %>
        </span>
      </p>
    </div>
  </div>
  <%= render partial: "imports/sample_table" %>
</div>
